import Admonition from "@theme/Admonition";

# system

## Обзор {#overview}

Раздел `system` в настройках Testplane не является обязательным.

Используйте его, чтобы:

-   включить режим дебага для WebDriver'а;
-   изменить mocha-таймауты для тестов;
-   занести какие-либо данные в глобальный контекст, который будут видеть все тесты;
-   задать типы ошибок, при которых нужно закрывать текущую сессию браузера навсегда, а не пытаться её переиспользовать;
-   задать число подпроцессов, в которых будут запускаться тесты, чтобы ускорить их выполнение;
-   определить максимально доступное количество браузеров в один момент времени (может быть актуально, если вы получаете браузеры из облачного сервиса, где есть такие ограничения);
-   задать расширения файлов, среди которых Testplane будет искать тесты;
-   и т. д.

## Настройка {#setup}

Раздел `system` имеет следующий формат:

```javascript
module.exports = {
    system: {
        debug: false,
        mochaOpts: {
            timeout: 60000,
        },
        ctx: {
            // ...
        },
        // Сессия будет закрыта, если тест упадет с ошибкой,
        // соответствующей одному из указанных шаблонов,
        // после чего будет создана новая сессия,
        // чтобы исключить инфраструктурные проблемы
        patternsOnReject: [
            /timeout/i,
            /timedout/i,
            /timed out/i,
            // ...
        ],
        workers: 1,
        testsPerWorker: Infinity,
        parallelLimit: 15,
        fileExtensions: [".js", ".ts"],
    },

    // другие настройки Testplane...
};
```

### Расшифровка параметров конфигурации {#setup_description}

<table>
<thead>
<tr><td>**Параметр**</td><td>**Тип**</td><td>**По&nbsp;умолчанию**</td><td>**Описание**</td></tr>
</thead>
<tbody>
<tr><td>[debug](#debug)</td><td>Boolean</td><td>false</td><td>Включить / отключить режим отладки для WebDriver.</td></tr>
<tr><td>[mochaOpts](#mocha_opts)</td><td>Object</td><td>_[см. ниже](#mocha_opts)_</td><td>Дополнительные опции для _mocha_.</td></tr>
<tr><td>[ctx](#ctx)</td><td>Object</td><td>`{ }`</td><td>Контекст, который будет доступен во всех тестах через метод _testplane.ctx._</td></tr>
<tr><td>[patternsOnReject](#patterns_on_reject)</td><td>Array</td><td>`[ ]`</td><td>Список шаблонов ошибок. Сессия будет закрыта, если тест упадет с ошибкой, соответствующей одному из указанных шаблонов. После чего будет создана новая сессия, чтобы исключить инфраструктурные проблемы.</td></tr>
<tr><td>[workers](#workers)</td><td>Number</td><td>1</td><td>Число подпроцессов, которые будут запущены для выполнения тестов.</td></tr>
<tr><td>[testsPerWorker](#tests_per_worker)</td><td>Number</td><td>Infinity</td><td>Максимальное количество тестов, которые будут запущены в одном подпроцессе, прежде чем подпроцесс будет перезапущен.</td></tr>
<tr><td>[parallelLimit](#parallel_limit)</td><td>Number</td><td>1</td><td>Максимальное количество браузеров, которые могут быть запущены одновременно.</td></tr>
<tr><td>[fileExtensions](#file_extensions)</td><td>Array</td><td>`[.js]`</td><td>Расширения файлов, в которых Testplane будет искать тесты для запуска.</td></tr>

</tbody>
</table>

### debug {#debug}

Включает режим отладки для WebDriver, если установить значение в `true`. По умолчанию: `false`.

### mochaOpts {#mocha_opts}

Дополнительные опции для `mocha`, которые передаются в `mocha.setup`. См. список доступных опций в [документации для Mocha](https://mochajs.org/). По умолчанию: `{ timeout: 60000 }`.

```javascript
module.exports = {
    system: {
        mochaOpts: {
            timeout: 60000, // таймаут выполнения теста
        },

        // другие системные настройки...
    },

    // другие настройки Testplane...
};
```

### ctx {#setup_ctx}

Контекст, который будет доступен во всех тестах через метод `testplane.ctx`. Предназначен для совместного использования каких-либо данных между всеми тестами, без необходимости прибегать к использованию глобальных переменных.

Например:

```javascript
module.exports = {
    system: {
        ctx: {
            services: ["video", "images"],
        },

        // другие системные настройки...
    },

    // другие настройки Testplane...
};
```

```javascript
it("awesome test", function () {
    console.log(testplane.ctx); // { services: ['video', 'images'] }
});
```

<Admonition type="tip">
    Используйте в тестах _testplane.ctx_ вместо глобальных переменных.
</Admonition>

### patternsOnReject {#patterns_on_reject}

Сессия будет закрыта, если тест упадет с ошибкой, соответствующей одному из указанных шаблонов в `patternsOnReject`. После чего будет создана новая сессия, чтобы исключить инфраструктурные проблемы.

Пример:

```javascript
module.exports = {
    system: {
        patternsOnReject: [
            /timeout/i,
            /timedout/i,
            /timed out/i,

            // другие шаблоны...
        ],

        // другие системные настройки...
    },

    // другие настройки Testplane...
};
```

### workers {#workers}

Testplane запускает все тесты в подпроцессах, чтобы уменьшить использование CPU для главного процесса и не упираться в ограничение по памяти для _Node.js._ Данная опция задает число подпроцессов, которые будут запущены для выполнения тестов. По умолчанию: `1`.

### testsPerWorker {#tests_per_worker}

Максимальное количество тестов, которые будут запущены в одном подпроцессе, прежде чем подпроцесс будет перезапущен. По умолчанию: `Infinity`.

### parallelLimit {#parallel_limit}

По умолчанию Testplane запускает все браузеры одновременно. Иногда (например, при использовании облачных сервисов, таких как [SauceLabs][sauce-labs]) вам может понадобиться ограничить количество браузеров, которые могут быть запущены одновременно. Данная опция задает это ограничение. По умолчанию: `Infinity`.

### fileExtensions {#file_extensions}

Расширения файлов, в которых Testplane будет искать на файловой системе тесты для запуска. По умолчанию: `[.js]`.

[sauce-labs]: https://saucelabs.com
