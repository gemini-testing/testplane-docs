import Admonition from "@theme/Admonition";

# Как убрать скроллбары из скриншотов

## Проблема {#problem}

Одна из причин падений тестов при тестировании верстки с помощью скриншотов &mdash; это появление скроллбара в браузере в момент снятия скриншота. При этом возможны 3 варианта, когда при прогоне теста возникает дифф между эталонным скриншотом и текущим, который был заснят в тесте в момент прогона:

1. В момент снятия эталонного скриншота скроллбара не было, но он появился при снятии текущего скриншота.
2. В момент снятия эталонного скриншота скроллбар был, однако при снятии текущего скриншота скроллбар появиться не успел.
3. Скроллбар есть и на эталонном скриншоте и на текущем, но положения скроллбаров, или их размеры, или прозрачность отличаются из-за разницы во времени, когда были сделаны скриншоты относительно появления скроллбара.

На скриншоте ниже приведен пример, который соответствует первому варианту:

![дифф из-за скроллбара](/img/docs/guides/how-to-hide-scrollbars.diff-in-screenshot.png)

## Решение 1: screenshotDelay {#solution_1}

В настройках testplane есть обязательная опция `browsers`, которая задает набор браузеров, доступных в проекте, и их свойства. Выберите браузер, в котором у вас возникают диффы из-за скроллбаров, и добавьте для него опцию `screenshotDelay`:

```javascript
module.exports = {
    browsers: {
        iphone: {
            screenshotDelay: 600, // Задержка перед снятием скриншота в мс

            // другие настройки браузера...
        },

        // другие браузеры...
    },

    // другие настройки testplane...
};
```

Опция `screenshotDelay` задает паузу в миллисекундах, которую testplane должна выдержать перед снятием скриншота (прежде чем выполнять команду `assertView`).

### Как это может помочь? {#how_can_it_help}

Часто скриншоты возникают из-за того, что тест должен подскроллить страницу к требуемому элементу, прежде чем сделать скриншот. После того как подскролл выполнен, скроллбар может еще какое-то время «висеть» на экране и соответственно, попасть на скриншот, если тот будет выполнен немедленно. Задержка `screenshotDelay` дает скроллбару время на то, чтобы исчезнуть.

Однако, данный способ помогает далеко не всегда, так как зависит от реализации браузеров и их поведения.

## Решение 2: отключение скроллбаров {#solution_2}

Если скроллбары возникают на скриншотах в Chrome-браузере, то их можно отключить с помощью [DevTools протокола][CDP].

Для этого добавьте в свой проект плагин [hermione-hide-scrollbars][hermione-hide-scrollbars] и укажите в его настройках список браузеров, для которых необходимо отключать скроллбары в тестах.

<Admonition type="warning">
    Обновите Chrome-браузер до версии 72.1 и выше, чтобы данная функциональность работала в ваших
    тестах. Так как более ранние версии Chrome-браузеров не поддерживают команду
    _Emulation.setScrollbarsHidden_, с помощью которой отключаются скроллбары.
</Admonition>

## Ключевые слова {#keywords}

-   screenshotDelay
-   hermione-hide-scrollbars

[hermione-hide-scrollbars]: ../plugins/hermione-hide-scrollbars
[CDP]: https://chromedevtools.github.io/devtools-protocol/
