import Admonition from "@theme/Admonition";

# Как отладить работу теста

## Проблема {#problem}

При разработке тестов, рано или поздно, любой разработчик начинает сталкиваться с ошибками, которые трудно обнаружить с помощью обычного просмотра кода. И тогда приходится применять уже программные инструменты, чтобы понять, где закралась ошибка, или почему тест ведет себя не так, как от него ожидает разработчик.

Давайте разберемся, какие возможности есть у разработчика testplane-тестов.

## Решение 1: опция --inspect или --inspect-brk {#solution_1}

Для того чтобы видеть как тест выполняется шаг за шагом, в testplane существует режим отладки. Этот режим опирается на [интеграцию V8 инспектора с Node.js](https://nodejs.org/dist/latest-v16.x/docs/api/debugger.html#advanced-usage).

<details>

<summary>
Про интеграцию V8 инспектора с Node.js

</summary>

Интеграция с инспектором _V8_ позволяет подключать _Chrome DevTools_ к инстансу _Node.js_ для отладки и профилирования. Для этого используется протокол _Chrome DevTools._

Инспектор _V8_ можно включить, передав опцию `--inspect` при запуске приложения на _Node.js._ Также можно указать пользовательский порт с этой опцией, например, `--inspect=9222` будет принимать подключения `DevTools` на порту `9222`.

Чтобы остановить выполнение кода на первой строке приложения, вместо опции `--inspect` используйте опцию `--inspect-brk`.

```bash
$ node --inspect index.js
Debugger listening on ws://127.0.0.1:9229/dc9010dd-f8b8-4ac5-a510-c1a114ec7d29
For help, see: https://nodejs.org/en/docs/inspector
```

_В приведенном выше примере `UUID dc9010dd-f8b8-4ac5-a510-c1a114ec7d29` в конце URL'а генерируется «на лету», и отличается в разных сеансах отладки._

Если браузер Chrome старше `66.0.3345.0`, используйте `inspector.html` вместо `js_app.html` в приведенном выше URL-адресе.

_Chrome DevTools_ пока не поддерживает отладку [рабочих потоков](https://nodejs.org/dist/latest-v16.x/docs/api/worker_threads.html). Для их отладки можно использовать [ndb](https://github.com/GoogleChromeLabs/ndb/).

</details>

Чтобы запустить тест в этом режиме, используйте опцию `--inspect`. Если вы хотите, чтобы отладчик остановился на первой строке кода, то используйте опцию `--inspect-brk`.

Пример:

```bash
testplane path/to/mytest.js --inspect
```

<Admonition type="info">
    В режиме отладки запускается только один рабочий процесс, и все тесты выполняются только в нем.
    Используйте этот режим с параметром _sessionsPerBrowser=1_ для отладки тестов по одному за раз.
</Admonition>

## Ключевые слова {#keywords}

-   --inspect
-   --inspect-brk

## Полезные ссылки {#useful_links}

-   [Про Chrome DevTools](https://developer.chrome.com/docs/devtools/)
