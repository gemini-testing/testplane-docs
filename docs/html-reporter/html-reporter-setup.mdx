import Version from "../_partials/specs/version.mdx";

---

## sidebar_position: 2

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import Admonition from "@theme/Admonition";
import ConfigExamples from "/docs/_partials/html-reporter-config-examples.mdx";

# Configuration

## Config Examples {#setup}

<ConfigExamples />

## Configuration Reference {#setup_description}

<table>
<thead>
<tr><td>**Parameter**</td><td>**Type**</td><td>**Default&nbsp;value**</td><td>**Description**</td></tr>
</thead>
<tbody>
<tr><td>[enabled](#enabled)</td><td>`boolean`</td><td>`true`</td><td>Enable / disable the plugin.</td></tr>
<tr><td>[path](#path)</td><td>`string`</td><td>`"testplane-report"`</td><td>The path to the folder for saving html-report files.</td></tr>
<tr><td>[saveErrorDetails](#saveerrordetails)</td><td>`boolean`</td><td>`false`</td><td>Save / do not save error details in json files.</td></tr>
<tr><td>[uiMode](#uimode)</td><td>`string`</td><td>`null`</td><td>Default UI mode: "old" for classic interface, "new" for modern interface.</td></tr>
<tr><td>[defaultView](#defaultview)</td><td>`string`</td><td>`"all"`</td><td>The test filtering mode when displayed, which will be set by default.</td></tr>
<tr><td>[diffMode](#diffmode)</td><td>`string`</td><td>`"3-up"`</td><td>The mode of viewing diffs, which will be set by default.</td></tr>
<tr><td>[baseHost](#basehost)</td><td>`string`</td><td>_N/A_</td><td>Replaces the original host address for viewing in the browser.</td></tr>
<tr><td>[errorPatterns](#errorpatterns)</td><td>`ErrorPattern[] | string[]`</td><td>`[]`</td><td>Error patterns with hints to improve the UX of the report.</td></tr>
<tr><td>[metaInfoBaseUrls](#metainfobaseurls)</td><td>`Record<string, string>`</td><td>`{}`</td><td>Base URLs for generating links in the _Meta_ section based on meta information about the tests run.</td></tr>
<tr><td>[saveFormat](#saveformat)</td><td>`string`</td><td>`"sqlite"`</td><td>DEPRECATED. Allows you to set the format in which the results of the tests run will be saved.</td></tr>
<tr><td>[customGui](#customgui)</td><td>`CustomGUI`</td><td>`{ }`</td><td>DEPRECATED. Use [plugins](#plugins) instead. Description of custom controls for GUI mode.</td></tr>
<tr><td>[pluginsEnabled](#pluginsenabled)</td><td>`boolean`</td><td>`false`</td><td>Enable plugins for the report.</td></tr>
<tr><td>[plugins](#plugins)</td><td>`Plugin[]`</td><td>`[]`</td><td>A list of plugins with their settings.</td></tr>
<tr><td>[customScripts](#customscripts)</td><td>`AnyFunction[]`</td><td>`[]`</td><td>A list of functions that implement custom scripts. For example, Yandex.Metrika scripts or a Bug.</td></tr>
<tr><td>[yandexMetrika](#yandexmetrika)</td><td>`YandexMetrika`</td><td>*see below*</td><td>[Yandex.Metrika][yandex-metrika].</td></tr>
<tr><td>[generateBadges](#generatebadges)</td><td>`GenerateBadges`</td><td>`null`</td><td>A callback that is called after every test run. It receives the test result and returns a list of badges.</td></tr>

</tbody>
</table>

### enabled

Enables or disables the plugin.

### path

The path to the folder for saving html-report files. By default, the files will be saved to the `testplane-report` folder in the current working folder.

### saveErrorDetails

Save or not save error details in json files (to the `error-details` folder).

By default, "do not save": `false`.

Any Testplane plugin can add any details to the error object when it occurs. These details can help the user in debugging problems that have occurred in the test. Html-reporter saves these details in the `error-details` folder in a file named: `<hash from the full name of the test>-<browser>_<retry number>_<timestamp>.json`.

Under the stack trace, the html-reporter adds an `Error details` section with a `<title>` link pointing to the json file. The user can open this file either in the browser or in any IDE.

Example of how to add details to an error object from a plugin:

```javascript
const err = new Error("some error");

err.details = {
    title: "description, will be used as url title",
    data: {}, // or [], or String
};

throw err;
```

### uiMode

Default UI mode: "old" for classic interface, "new" for modern interface. Affects redirects between old and new interfaces.

By default, no redirects are performed.

Available values: `"old"`, `"new"`.

For example, if set to `"new"`, users will be redirected to the new interface when trying to access the old interface. However, if the user manually clicks "return to old interface", this preference will be saved, and they will always use the old interface until they switch back.

### defaultView

The test filtering mode when displayed, which will be set by default. The following values are available:

<table>
<thead>
<tr><td>**View&nbsp;mode**</td><td>**Description**</td></tr>
</thead>
<tbody>
<tr><td>all</td><td>all tests</td></tr>
<tr><td>passed</td><td>only passed tests</td></tr>
<tr><td>failed</td><td>only failed tests</td></tr>
<tr><td>retried</td><td>only those tests in which there were retries (re-runs)</td></tr>
<tr><td>skipped</td><td>only disabled (skipped) tests</td></tr>

</tbody>
</table>

By default: `all`, that is, if the parameter is not set, all tests will be displayed.

### diffMode

The mode of viewing diffs, which will be set by default. The following values are available:

<table>
<thead>
<tr><td>**Diff&nbsp;mode**</td><td>**Description**</td></tr>
</thead>
<tbody>
<tr><td>3-up</td><td>all images _(expected, actual, diff)_ in one column, under each other</td></tr>
<tr><td>3&#8209;up&#8209;scaled</td><td>all images _(expected, actual, diff)_ in one row so that they fit on the screen</td></tr>
<tr><td>only-diff</td><td>only diff image</td></tr>
<tr><td>switch</td><td>reference image with the ability to switch to the actual image by mouse click</td></tr>
<tr><td>swipe</td><td>the actual image on top of the reference image, with a separator opening the reference image</td></tr>
<tr><td>onion-skin</td><td>the actual image on top of the reference with the ability to change the transparency of the actual image</td></tr>

</tbody>
</table>

By default: `3-up`.

### baseHost

Replaces the original host address for viewing in the browser. By default, the original host address is not changed.

### errorPatterns

Error patterns are used:

-   to show more understandable error information if they correspond to patterns for which there is a detailed description;
-   in the `Group by` display mode with the `error` key selected.

Error patterns can be set either as objects or as strings.

To set the error pattern as an object, use the following format:

```javascript
{
    name: '<error name>',
    pattern: '<error pattern>',
    hint: '<hint to the user>'
}
```

where:

<table>
<thead>
<tr><td>**Parameter**</td><td>**Type**</td><td>**Description**</td></tr>
</thead>
<tbody>
<tr><td>name</td><td>`string`</td><td>Error name.</td></tr>
<tr><td>pattern</td><td>`string | RegExp`</td><td>A regular expression or a regular string that the error should match.</td></tr>
<tr><td>hint</td><td>`string`</td><td>Optional parameter. A hint of what can be done with this error: why it occurred, how to fix it, etc.</td></tr>

</tbody>
</table>

If the error pattern is specified as a string, for example: `<error>`, then this string is automatically treated as an object of the form:

```javascript
{
    name: '<error>',
    pattern: '<error>'
}
```

This way of setting a pattern is convenient for those errors where `name` and `pattern` are completely the same.

When one of the error patterns matches the error message, then:

-   the `name` of the error template will be displayed as the title of the error message, and the original error message will be hidden under the cut;
-   the `hint` for the error will be displayed after the error field `stack`. The hint can be specified as an html string. For example, `<div>some-useful-hint</div>`.

In the `Group by` mode with the selected `error` key, the test will be associated with the group if the test error matches the group error pattern. If the test cannot be linked to existing groups, a new group will be created.

### metaInfoBaseUrls

Base URLs for generating links in the `Meta` section based on meta information about the tests run.

The parameter is set as an object:

```javascript
{
    '<option-1>': 'value of option 1',
    '<option-2>': 'value of option 2',
    // etc.
}
```

For example:

```javascript
{
    'file': 'base/path'
}
```

When the value of any key is set to `auto`, the base URL will be set to the base host specified in the report UI, or remain unchanged if the base host is not specified.

For example, if you have the following `metaInfoBaseUrls` value:

```javascript
{
    custom_url: "auto";
}
```

And you set the `meta.custom_url` field to `https://example.com/some/path` in your tests, you will see in the meta:

-   A link to `https://example.com/some/path` if the base host is not set in the UI
-   A link to `https://another-host.com/some/path` if the base host in the UI is set to `https://another-host.com`

### saveFormat

**DEPRECATED**

Allows you to set the format in which the results of the tests run will be saved.

Only one value is available now, which is used by default:

-   `sqlite` — save the results of the tests run in the database of SQLite format.

### customGui

**DEPRECATED**

<Admonition type="warning">
    Instead of customGui, it is recommended to use [report plugins](#plugins).
</Admonition>

Description of custom controls for GUI mode.

See more in the section "[Customizing GUI](../html-reporter-custom-gui)".

### pluginsEnabled

Enable plugins for `html-reporter`.

### plugins

A list of plugins with their settings.

See more details in the section "[Plugins](../html-reporter-plugins)".

### customScripts

A list of custom scripts in the form of an array of functions. Using this parameter, you can add any script to the html-report page. For example, to collect any metrics or implement additional functionality. The scripts will be executed immediately after rendering the page.

For example:

```javascript
customScripts: [
    function () {
        console.info("some logs");
    },
    () => {
        const div = document.createElement("div");
        div.innerHTML = "hello";
        document.body.prepend(div);
    },
];
```

### yandexMetrika

By default, anonymous data about report UI usage is collected for analysis and UX improvement purposes. Data collected includes report loading speed, frequency of some feature usage (e.g., test sorting), and clicks on UI elements. Data about your project or test content is NOT collected under any circumstances.

If you don't want to share analytics with us, you can disable it in any of the following ways:

-   In the config
    ```javascript
    module.exports = {
        plugins: {
            "html-reporter/testplane": {
                yandexMetrika: {
                    enabled: false,
                },
                // other html-reporter settings...
            },
            // other Testplane plugins...
        },
        // other Testplane settings...
    };
    ```
-   Using environment variables: `html_reporter_yandex_metrika_enabled=false` or simply `NO_ANALYTICS=true`
-   Using CLI arguments: `--html-reporter-yandex_metrika_enabled=false`

### generateBadges

<Version version="11.4.0" />

A callback that is called after every test run. It receives the test result and returns a list of badges.

Usage example: here we set the issue name and URL, the branch name.

```typescript title="testplane.config.ts"
{
    // other Testplane config...
    plugins: {
        "html-reporter/testplane": {
            //...
            generateBadges: (test) => [
                {
                    title: test.meta.issueTitle,
                    icon: 'LogoYandexTracker',
                    url: test.meta.issueUrl,
                },
                {
                    title: test.meta.branch,
                    icon: 'BranchesRight',
                },
            ]
        }
    }
}
```

An example of a test where you can set metadata.

```typescript title="testplane.config.ts"
describe("badges", () => {
    it("badge example", async ({ browser }) => {
        await browser.setMeta("issueTitle", "ticket-1234");
        await browser.setMeta("issueUrl", "https://example.com");
        await browser.setMeta("branch", "master");

        await browser.pause(3000);
    });
});
```

#### Badge params

<table>
    <thead>
        <tr>
            <td>**Name**</td>
            <td>**Type**</td>
            <td>**Description**</td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>`title`</td>
            <td>`string`</td>
            <td>
                Optional parameter. Displayed badge title. If not provided, the badge will not
                render.
            </td>
        </tr>
        <tr>
            <td>`icon`</td>
            <td>`string`</td>
            <td>Optional parameter. Name of icon from [GravityUI][gravity-ui-icons].</td>
        </tr>
        <tr>
            <td>`url`</td>
            <td>`string`</td>
            <td>Optional parameter. Url of badge.</td>
        </tr>
    </tbody>
</table>

### Passing parameters via the CLI {#setup_by_cli}

All plugin parameters that can be defined in the config can also be passed as command line options or through environment variables during Testplane startup. Use the prefix `--html-reporter-` for command line options and `html_reporter_` for environment variables.

For example, the settings parameter [path](#path) can be passed in the following ways:

```bash
testplane path/to/mytest.js --html-reporter-path custom/dir
```

```bash
html_reporter_path=custom/dir testplane path/to/mytest.js
```

## Data storage {#data_storage}

As mentioned above, `html-reporter` saves the tests run results to the [SQLite][sqlite] database.

Why do we use SQLite? Because it is:

-   serverless, easy to connect and requires no configuration
-   cross-platform, runs on any operating system
-   single-file, easy to reuse reports and share them
-   faster than if you store the report on the file system
-   compact and has full SQL.

Files that are created during the execution of tests:

-   `sqlite.db`—Sqlite database with tests run results
-   `data.js`—report configuration
-   `databaseUrls.json`—absolute or relative URLs to SQLite databases (`sqlite.db`) and/or URLs of other `databaseUrls.json` files (see command [merge-reports][merge-reports]).

[html-reporter]: https://github.com/gemini-testing/html-reporter
[testplane]: https://github.com/gemini-testing/testplane
[sqlite]: https://www.sqlite.org/index.html
[yandex-metrika]: https://yandex.ru/support/metrica/index.html
[yandex-metrika-goals]: https://yandex.ru/support/metrica/general/goals.html
[how-to-create-counter]: https://yandex.ru/support/metrica/general/creating-counter.html
[merge-reports]: ../html-reporter-commands#merge-reports
[http-server]: https://github.com/http-party/http-server#http-server-a-simple-static-http-server
[gravity-ui-icons]: https://gravity-ui.com/ru/icons
