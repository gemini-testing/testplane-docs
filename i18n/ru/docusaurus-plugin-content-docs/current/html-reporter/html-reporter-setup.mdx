---
sidebar_position: 2
---

import Admonition from "@theme/Admonition";
import ConfigExamples from "../_partials/html-reporter-config-examples.mdx";
import Version from "../_partials/specs/version.mdx";

# Конфигурация

## Примеры настройки {#setup}

<ConfigExamples />

## Справочник по параметрам конфигурации {#setup_description}

<table>
<thead>
<tr><td>**Параметр**</td><td>**Тип**</td><td>**По&nbsp;умолчанию**</td><td>**Описание**</td></tr>
</thead>
<tbody>
<tr><td>[enabled](#enabled)</td><td>`boolean`</td><td>`true`</td><td>Включить / отключить плагин.</td></tr>
<tr><td>[path](#path)</td><td>`string`</td><td>`"testplane-report"`</td><td>Путь к папке для сохранения файлов html-отчета.</td></tr>
<tr><td>[saveErrorDetails](#saveerrordetails)</td><td>`boolean`</td><td>`false`</td><td>Сохранять / не сохранять подробности ошибок в json-файлах.</td></tr>
<tr><td>[uiMode](#uimode)</td><td>`string`</td><td>`null`</td><td>Режим интерфейса по умолчанию: "old" для классического интерфейса, "new" для современного интерфейса.</td></tr>
<tr><td>[defaultView](#defaultview)</td><td>`string`</td><td>`"all"`</td><td>Режим фильтрации тестов при отображении, который будет установлен по умолчанию.</td></tr>
<tr><td>[diffMode](#diffmode)</td><td>`string`</td><td>`"3-up"`</td><td>Режим просмотра диффов, который будет установлен по умолчанию.</td></tr>
<tr><td>[baseHost](#basehost)</td><td>`string`</td><td>_N/A_</td><td>Заменяет оригинальный адрес хоста для просмотра в браузере.</td></tr>
<tr><td>[errorPatterns](#errorpatterns)</td><td>`ErrorPattern[] | string[]`</td><td>`[]`</td><td>Паттерны ошибок с подсказками для улучшения UX отчета.</td></tr>
<tr><td>[metaInfoBaseUrls](#metainfobaseurls)</td><td>`Record<string, string>`</td><td>`{}`</td><td>Базовые URL-адреса для формирования ссылок в разделе _Meta_ на основе мета-информации о прогоне теста.</td></tr>
<tr><td>[saveFormat](#saveformat)</td><td>`string`</td><td>`"sqlite"`</td><td>ПАРАМЕТР УСТАРЕЛ. Позволяет задать формат, в котором будут сохранены результаты прогона тестов.</td></tr>
<tr><td>[customGui](#customgui)</td><td>`CustomGUI`</td><td>`{ }`</td><td>ПАРАМЕТР УСТАРЕЛ. Используйте вместо него [plugins](#plugins). Описание собственных элементов управления для GUI-режима.</td></tr>
<tr><td>[pluginsEnabled](#pluginsenabled)</td><td>`boolean`</td><td>`false`</td><td>Включить плагины для отчета.</td></tr>
<tr><td>[plugins](#plugins)</td><td>`Plugin[]`</td><td>`[]`</td><td>Список плагинов с их настройками.</td></tr>
<tr><td>[customScripts](#customscripts)</td><td>`AnyFunction[]`</td><td>`[]`</td><td>Список функций, реализующих кастомные скрипты. Например, скрипты Яндекс.Метрики или Жучка.</td></tr>
<tr><td>[yandexMetrika](#yandexmetrika)</td><td>`YandexMetrika`</td><td>*см. ниже*</td><td>[Яндекс.Метрика][yandex-metrika].</td></tr>
<tr><td>[generateBadges](#generatebadges)</td><td>`GenerateBadges`</td><td>`null`</td><td>Функция, который вызывается после каждого запуска теста. Он получает результат теста и возвращает список бейджей.</td></tr>

</tbody>
</table>

### enabled

Включает или отключает плагин.

### path

Путь к папке для сохранения файлов html-отчета. По умолчанию файлы будут сохранены в папку `testplane-report` в текущей рабочей папке.

### saveErrorDetails

Сохранять или не сохранять подробности ошибок в json-файлах (в папку `error-details`).

По умолчанию «не сохранять»: `false`.

Любой плагин testplane может добавить какие-либо подробности в объект ошибки при её возникновении. Эти подробности могут помочь пользователю в отладке проблем, которые возникли в тесте. Html-reporter сохраняет эти детали в папке `error-details` в файле с именем: `<хэш от полного названия теста>-<браузер>_<номер ретрая>_<временная метка>.json`.

Под стектрейсом html-reporter добавляет раздел `Error details` со ссылкой `<title>`, указывающей на json-файл. Пользователь может открыть этот файл либо в браузере, либо в любой IDE.

Пример как добавить подробности в объект ошибки из плагина:

```javascript
const err = new Error("some error");

err.details = {
    title: "description, will be used as url title",
    data: {}, // или [], или String
};

throw err;
```

### uiMode

Режим интерфейса по умолчанию: "old" для классического интерфейса, "new" для современного интерфейса. Влияет на редиректы между старым и новым интерфейсом.

По умолчанию редиректы не выполняются.

Доступны следующие значения: `"old"`, `"new"`.

Например, если установлено значение `"new"`, то пользователи будут перенаправляться на новый интерфейс при попытке доступа к старому интерфейсу. Однако, если пользователь вручную нажмет кнопку "вернуться к старому интерфейсу", эта настройка будет сохранена, и он всегда будет использовать старый интерфейс, пока не переключится обратно.

### defaultView

Режим фильтрации тестов при отображении, который будет установлен по умолчанию. Доступны следующие значения:

<table>
<thead>
<tr><td>**Режим**</td><td>**Описание**</td></tr>
</thead>
<tbody>
<tr><td>all</td><td>все тесты</td></tr>
<tr><td>passed</td><td>только успешные тесты</td></tr>
<tr><td>failed</td><td>только упавшие тесты</td></tr>
<tr><td>retried</td><td>только те тесты, в которых были ретраи (повторные запуски)</td></tr>
<tr><td>skipped</td><td>только отключенные (заскипанные) тесты</td></tr>

</tbody>
</table>

По умолчанию: `all`, то есть если параметр не задан, то будут показываться все тесты.

### diffMode

Режим просмотра диффов, который будет установлен по умолчанию. Доступны следующие значения:

<table>
<thead>
<tr><td>**Режим**</td><td>**Описание**</td></tr>
</thead>
<tbody>
<tr><td>3-up</td><td>все изображения _(expected, actual, diff)_ в одном столбце, друг под другом</td></tr>
<tr><td>3&#8209;up&#8209;scaled</td><td>все изображения _(expected, actual, diff)_ в один ряд так, чтобы они помещались на экране</td></tr>
<tr><td>only-diff</td><td>только дифф _(diff)_</td></tr>
<tr><td>switch</td><td>эталонное изображение с возможностью переключаться на актуальное изображение по клику мыши</td></tr>
<tr><td>swipe</td><td>актуальное изображение поверх эталонного, с разделителем открывающим эталонное изображение</td></tr>
<tr><td>onion-skin</td><td>актуальное изображение поверх эталонного с возможностью менять прозрачность актуального изображения</td></tr>

</tbody>
</table>

По умолчанию: `3-up`.

### baseHost

Заменяет оригинальный адрес хоста для просмотра в браузере. По умолчанию оригинальный адрес хоста не изменяется.

### errorPatterns

Паттерны ошибок используются:

-   чтобы показать более понятную информацию об ошибках, если они соответствуют паттернам, для которых есть подробное описание;
-   в режиме отображения `Group by` с выбранным ключом `error`.

Паттерны ошибок можно задавать как в виде объектов, так и в виде строк.

Чтобы задать паттерн ошибки в виде объекта, используйте следующий формат:

```javascript
{
    name: '<название ошибки>',
    pattern: '<паттерн ошибки>',
    hint: '<подсказка пользователю>'
}
```

где:

<table>
<thead>
<tr><td>**Параметр**</td><td>**Тип**</td><td>**Описание**</td></tr>
</thead>
<tbody>
<tr><td>name</td><td>`string`</td><td>Название ошибки.</td></tr>
<tr><td>pattern</td><td>`string | RegExp`</td><td>Регулярное выражение или обычная строка, которой должна соответствовать ошибка.</td></tr>
<tr><td>hint</td><td>`string`</td><td>Необязательный параметр. Подсказка, что можно сделать с данной ошибкой: почему она возникла, как её исправить и т. п.</td></tr>

</tbody>
</table>

Если паттерн ошибки задан в виде строки, например: `&lt;ошибка>`, то эта строка автоматически рассматривается как объект вида:

```javascript
{
    name: '<ошибка>',
    pattern: '<ошибка>'
}
```

Такой способ задания паттерна удобен для тех ошибок, у которых `name` и `pattern` полностью совпадают.

Когда один из шаблонов ошибок совпадает с сообщением об ошибке, то:

-   `name` шаблона ошибки будет отображаться как заголовок сообщения об ошибке, а исходное сообщение об ошибке будет скрыто под катом;
-   `hint` для ошибки будет отображаться после поля ошибки `stack`. Подсказка может быть задана в виде html-строки. Например, `<div>some-useful-hint</div>`.

В режиме `Group by` _(группировать по)_ с выбранным ключом `error` тест будет связан с группой, если ошибка теста совпадает с шаблоном ошибок группы. Если тест не может быть связан с существующими группами, то будет создана новая группа.

### metaInfoBaseUrls

Базовые URL-адреса для формирования ссылок в разделе `Meta` на основе мета-информации о прогоне теста.

Параметр задается в виде объекта:

```javascript
{
    '<опция-1>': 'значение опции 1',
    '<опция-2>': 'значение опции 2',
    // и т. д.
}
```

Например:

```javascript
{
    'file': 'base/path'
}
```

Когда значение любого ключа установлено на `auto`, базовый URL будет установлен на базовый хост, указанный в интерфейсе отчета, или останется неизменным, если базовый хост не указан.

Например, если у вас есть следующее значение `metaInfoBaseUrls`:

```javascript
{
    custom_url: "auto";
}
```

И вы установите поле `meta.custom_url` в `https://example.com/some/path` в ваших тестах, вы увидите в мете:

-   Ссылку на `https://example.com/some/path`, если базовый хост не установлен в интерфейсе пользователя
-   Ссылку на `https://another-host.com/some/path`, если базовый хост в интерфейсе пользователя установлен в `https://another-host.com`

### saveFormat

**Параметр устарел**

Позволяет задать формат, в котором будут сохранены результаты прогона тестов.

Доступным осталось только одно значение, которое используется по умолчанию:

-   `sqlite` — сохранить результаты прогона тестов в базе данных формата SQLite.

### customGui

**Параметр устарел**

<Admonition type="warning">
    Вместо _customGui_ рекомендуется использовать [плагины для отчета](#plugins).
</Admonition>

Описание собственных элементов управления для GUI-режима.

Смотрите подробнее в разделе «[Кастомизация GUI](../html-reporter-custom-gui)».

### pluginsEnabled

Включить плагины для `html-reporter`. По умолчанию: `false`.

### plugins

Список плагинов с их настройками. По умолчанию: `[]`.

Плагины позволяют расширять интерфейс отчета собственными UI-компонентами. Подробнее о разработке плагинов — в разделе «[Разработка плагинов](../html-reporter-plugins)».

#### Использование с пресетом {#plugins-with-preset}

Если плагин предоставляет пресет конфигурации, подключение выглядит так:

```typescript title="testplane.config.ts"
import myPlugin from "my-plugin-package";

export default {
    plugins: {
        "html-reporter/testplane": {
            enabled: true,
            pluginsEnabled: true,
            plugins: myPlugin({
                /* опции плагина */
            }),
        },
    },
};
```

#### Ручная конфигурация {#plugins-manual-config}

Плагины можно настроить вручную, указав массив объектов:

```typescript title="testplane.config.ts"
export default {
    plugins: {
        "html-reporter/testplane": {
            enabled: true,
            pluginsEnabled: true,
            plugins: [
                {
                    name: "my-plugin-package",
                    component: "MyPluginComponent",
                    point: "result_meta",
                    position: "after",
                    config: {
                        /* опции */
                    },
                },
            ],
        },
    },
};
```

#### Параметры плагина {#plugin-params}

<table>
    <thead>
        <tr>
            <td>**Параметр**</td>
            <td>**Тип**</td>
            <td>**Описание**</td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>name</td>
            <td>`string`</td>
            <td>Обязательный. Имя npm-пакета плагина.</td>
        </tr>
        <tr>
            <td>component</td>
            <td>`string`</td>
            <td>Имя React-компонента, экспортируемого из плагина.</td>
        </tr>
        <tr>
            <td>point</td>
            <td>`string`</td>
            <td>
                Точка расширения — место в интерфейсе для размещения компонента. См. [точки
                расширения](../html-reporter-plugins-api#extension-points).
            </td>
        </tr>
        <tr>
            <td>position</td>
            <td>`string`</td>
            <td>Позиция относительно точки расширения: `"wrap"`, `"before"` или `"after"`.</td>
        </tr>
        <tr>
            <td>config</td>
            <td>`object`</td>
            <td>Объект конфигурации, передаваемый в плагин через `pluginOptions.pluginConfig`.</td>
        </tr>
    </tbody>
</table>

Плагин с указанным только `name` может использоваться для добавления серверного middleware без UI-компонента.

### customScripts

Список кастомных скриптов в виде массива функций. С помощью этого параметра можно добавить любой скрипт на страницу html-отчета. Например, для сбора каких-либо метрик или реализации дополнительной функциональности. Скрипты будут выполнены сразу после рендеринга страницы.

Пример:

```javascript
customScripts: [
    function () {
        console.info("some logs");
    },
    () => {
        const div = document.createElement("div");
        div.innerHTML = "hello";
        document.body.prepend(div);
    },
];
```

### yandexMetrika

По умолчанию выполняется сбор анонимных сведений об использовании интерфейса отчета в целях анализа и улучшения UX. Собираются такие сведения, как скорость загрузки отчета, частота использования некоторых функций (например, сортировка тестов) и клики по элементам управления. Сведения о вашем проекте или содержимом тестов НЕ собираются ни при каких обстоятельствах.

Если вы не хотите делиться аналитикой с нами, вы можете отключить это любым из способов:

-   В конфиге
    ```javascript
    module.exports = {
        plugins: {
            "html-reporter/testplane": {
                yandexMetrika: {
                    enabled: false,
                },
                // другие настройки html-reporter...
            },
            // другие плагины Testplane...
        },
        // другие настройки Testplane...
    };
    ```
-   С помощью переменных окружения: `html_reporter_yandex_metrika_enabled=false` или просто `NO_ANALYTICS=true`
-   С помощью аргументов CLI: `--html-reporter-yandex_metrika_enabled=false`

### generateBadges

<Version version="11.4.0" />

Функция, который вызывается после каждого запуска теста. Он получает результат теста и возвращает список бейджей.

Пример использования: здесь мы задаём имя задачи со ссылкой на неё и название ветки.

```typescript title="testplane.config.ts"
{
    // other Testplane config...
    plugins: {
        "html-reporter/testplane": {
            //...
            generateBadges: (test) => [
                {
                    title: test.meta.issueTitle,
                    icon: 'LogoYandexTracker',
                    url: test.meta.issueUrl,
                },
                {
                    title: test.meta.branch,
                    icon: 'BranchesRight',
                },
            ]
        }
    }
}
```

Пример установки метаданных в тесте.

```typescript title="testplane.config.ts"
describe("badges", () => {
    it("badge example", async ({ browser }) => {
        await browser.setMeta("issueTitle", "ticket-1234");
        await browser.setMeta("issueUrl", "https://example.com");
        await browser.setMeta("branch", "master");

        await browser.pause(3000);
    });
});
```

#### Badge params

<table>
    <thead>
        <tr>
            <td>**Имя**</td>
            <td>**Тип**</td>
            <td>**Описание**</td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>`title`</td>
            <td>`string`</td>
            <td>
                Опциональный параметр. Отображаемое имя бейджа, но если не передать то бейдж не
                будет показываться.
            </td>
        </tr>
        <tr>
            <td>`icon`</td>
            <td>`string`</td>
            <td>Опциональный параметр. Имя иконки из [GravityUI][gravity-ui-icons].</td>
        </tr>
        <tr>
            <td>`url`</td>
            <td>`string`</td>
            <td>Опциональный параметр. Ссылка, открываемая при нажатии.</td>
        </tr>
    </tbody>
</table>

### Передача параметров через CLI {#setup_by_cli}

Все параметры плагина, которые можно определить в конфиге, можно также передать в виде опций командной строки или через переменные окружения во время запуска testplane. Используйте префикс `--html-reporter-` для опций командной строки и `html_reporter_` — для переменных окружения.

Например, параметр настроек [path](#path) можно передать следующими способами:

```bash
testplane path/to/mytest.js --html-reporter-path custom/dir
```

```bash
html_reporter_path=custom/dir testplane path/to/mytest.js
```

## Хранение данных {#data_storage}

Как уже было сказано выше, `html-reporter` сохраняет результаты прогона тестов в базу данных [SQLite][sqlite].

Почему мы используем SQLite? Потому что он:

-   бессерверный, легко подключаемый и не требует настроек
-   кросс-платформенный, запускается на любой операционной системе
-   одно-файловый, легко переиспользовать отчеты и делиться ими
-   быстрее, чем если хранить отчет на файловой системе
-   компактный и имеет полноценный SQL.

Файлы, который создаются во время выполнения тестов:

-   `sqlite.db` — база данных Sqlite с результатами прогона тестов
-   `data.js` — конфиг отчета
-   `databaseUrls.json` — абсолютные или относительные URL-адреса на базы данных SQLite (`sqlite.db`) и/или URL-адреса других файлов `databaseUrls.json` (см. команду [merge-reports][merge-reports])

[html-reporter]: https://github.com/gemini-testing/html-reporter
[testplane]: https://github.com/gemini-testing/testplane
[sqlite]: https://www.sqlite.org/index.html
[yandex-metrika]: https://yandex.ru/support/metrica/index.html
[yandex-metrika-goals]: https://yandex.ru/support/metrica/general/goals.html
[how-to-create-counter]: https://yandex.ru/support/metrica/general/creating-counter.html
[merge-reports]: ../html-reporter-commands#merge-reports
[http-server]: https://github.com/http-party/http-server#http-server-a-simple-static-http-server
