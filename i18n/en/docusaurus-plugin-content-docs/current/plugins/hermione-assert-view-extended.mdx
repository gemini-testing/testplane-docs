import Admonition from "@theme/Admonition";

# hermione-assert-view-extended

## Overview {#overview}

Use the `hermione-assert-view-extended` plugin to extend the capabilities of Testplane's `assertView` command.

The plugin allows you to take screenshots with minimal irrelevant diffs.

### What are irrelevant diffs? {#what_are_irrelevant_diffs}

Often in tests, when taking screenshots and comparing them with benchmarks, diffs arise that are not related to the test. Diffs may appear due to the following reasons:

-   animation on the page: for example, the animation did not have time to end, and the test is already taking a screenshot and the result does not match the standard; the fact is that the animation can be carried out differently each time, taking a screenshot may occur with a slight delay relative to the previous time or vice versa earlier than the last time. all this is enough for the screenshots to show the difference from each other when comparing;

-   the presence of elements in the layout that fall into the screenshot, but do not relate to the test and are not controlled by it, and may be different at different times due to their implementation;

-   [anti-aliasing][anti-aliasing] artifacts that occur due to a combination of certain element colors and background color.

The `hermione-assert-view-extended` plugin allows you to compensate to a large extent for the above disadvantages when properly configured. With it, you can disable animation, set which elements to ignore (they will be replaced with black rectangles), which elements to make invisible by setting them to zero opacity, or which elements to hide. You can also enable the application of your own CSS before taking a screenshot.

### Why can't we just hide all the irrelevant elements? {#why_not_to_hide}

Why do we need 3 options for how to exclude an element from a screenshot?

Because in some cases, removing an element from a page can lead to an undesirable change in the layout. That is, you will be testing essentially another page, and not the one that your user will actually see.

### What else does the plugin allow? {#what_else}

The plugin also allows you to specify the actions to be performed each time before taking a screenshot. Or actions to be performed after taking a screenshot. To do this, you need to specify handlers for _beforeach- and afterEach-_ hooks in the plugin settings.

## Install {#install}

```bash
npm install -D hermione-assert-view-extended
```

## Setup {#setup}

Add the plugin to the `plugins` section of the `testplane` config:

```javascript
module.exports = {
    plugins: {
        "hermione-assert-view-extended": {
            hooks: {
                beforeEach: function (name, selector, options) {
                    return this.browser.moveTo(0, 0);
                },
                afterEach: function (name, selector, options) {
                    console.log(`Asserted view '${name}' for '${selector}' selector.`);
                },
            },
            globalStyles: {
                animationDisabled: true,
                redraw: true,
                ignoreElements: [
                    // Page elements to be replaced with black rectangles
                    ".classname1",
                ],
                invisibleElements: [
                    // Page elements to be made completely transparent
                    ".classname3",
                ],
                hideElements: [
                    // Page elements to be hidden
                    ".classname2",
                ],
                customCSS: `
                    body {
                        background-color: red;
                    }
                `,
            },
        },

        // other testplane plugins...
    },

    // other testplane settings...
};
```

### Description of configuration parameters {#setup_description}

<table>
<thead>
<tr><td>**Parameter**</td><td>**Type**</td><td>**Default&nbsp;value**</td><td>**Description**</td></tr>
</thead>
<tbody>
<tr><td>hooks</td><td>Object</td><td>`{ }`</td><td>Обработчики для хуков _beforeEach_ и _afterEach_, которые будут вызваны до и после снятия скриншота.</td></tr>
<tr><td>globalStyles</td><td>Object</td><td>`{ }`</td><td>Переопределение стилей для различных элементов. Накладывается перед снятием скриншота и снимается после снятия.</td></tr>

</tbody>
</table>

### hooks parameters {#setup_hooks}

<table>
<thead>
<tr><td>**Parameter**</td><td>**Type**</td><td>**Default&nbsp;value**</td><td>**Description**</td></tr>
</thead>
<tbody>
<tr><td>beforeEach</td><td>Function</td><td>null</td><td>Функция-обработчик, которая будет выполняться _перед_ снятием каждого скриншота.</td></tr>
<tr><td>afterEach</td><td>Function</td><td>null</td><td>Функция-обработчик, которая будет выполняться _после_ снятия каждого скриншота.</td></tr>

</tbody>
</table>

### globalStyles parameters {#setup_global_styles}

<table>
<thead>
<tr><td>**Parameter**</td><td>**Type**</td><td>**Default&nbsp;value**</td><td>**Description**</td></tr>
</thead>
<tbody>
<tr><td>[animationDisabled](#setup_animation_disabled)</td><td>Boolean</td><td>false</td><td>Отключить CSS-анимацию.</td></tr>
<tr><td>[redraw](#setup_redraw)</td><td>Boolean</td><td>false</td><td>Перерисовать страницу браузера после применения всех новых стилей. Также перерисовка произойдет принудительно, независимо от значения этого параметра, если задан список _redrawElements._</td></tr>
<tr><td>[redrawMode](#setup_redraw_mode)</td><td>String</td><td>'medium'</td><td>Режим перерисовки: _soft, medium, hard._ См. подробности ниже.</td></tr>
<tr><td>[redrawElements](#setup_redraw_elements)</td><td>Array</td><td>`['body']`</td><td>Элементы страницы, которые нужно перерисовывать. Если элементы заданы, то перерисовка произойдет даже, если параметр _redraw_ установлен в _false._</td></tr>
<tr><td>[redrawTimeout](#setup_redraw_timeout)</td><td>Number</td><td>_N/A_</td><td>Пауза, перед тем как перерисовать элементы страницы, в мс.</td></tr>
<tr><td>[ignoreElements](#setup_ignore_elements)</td><td>Array</td><td>_N/A_</td><td>Элементы страницы, которые будут заменены на черные прямоугольники.</td></tr>
<tr><td>[invisibleElements](#setup_invisible_elements)</td><td>Array</td><td>_N/A_</td><td>Элементы страницы, которые будут сделаны полностью прозрачными.</td></tr>
<tr><td>[hideElements](#setup_hide_elements)</td><td>Array</td><td>_N/A_</td><td>Элементы страницы, которые будут спрятаны.</td></tr>
<tr><td>[customCSS](#setup_custom_css)</td><td>String</td><td>_N/A_</td><td>Собственные стили, которые будут применены перед снятием скриншота.</td></tr>

</tbody>
</table>

### animationDisabled {#setup_animation_disabled}

Animation is disabled using CSS styles `transition-duration: 0s`, `animation-duration: 0s`, etc.

<details>
<summary>Can I get more details?</summary>
The following set of styles is used to disable animation:

```css
body,
body *,
body *:after,
body *:before,
body[class],
body[class] *,
body[class] *:after,
body[class] *:before {
    -webkit-animation-duration: 0s !important;
    -moz-animation-duration: 0s !important;
    -ms-animation-duration: 0s !important;
    animation-duration: 0s !important;
    -webkit-transition-duration: 0s !important;
    -moz-transition-duration: 0s !important;
    -ms-transition-duration: 0s !important;
    transition-duration: 0s !important;
    -webkit-transition-delay: 0s !important;
    -moz-transition-delay: 0s !important;
    -ms-transition-delay: 0s !important;
    transition-delay: 0s !important;
}
```

</details>

### redraw {#setup_redraw}

Enables forced redrawing of the browser page after applying all new styles. Also, the redrawing will be forced, regardless of the value of this parameter, if the `redrawElements` list is set.

### redrawMode {#setup_redraw_mode}

The redrawing mode can take the following values:

-   `soft` &mdash; redraw the page without reflowing using the `transform: translateZ(0)` style to all elements specified in the `redrawElements` list;
-   `medium` &mdash; reflow the page and redraw it using the `opacity: 0` style to all elements specified in the `redrawElements` list;
-   `hard` &mdash; reflow the page and redraw it using the `display: none` style to all elements specified in the `redrawElements` parameter.

### redrawElements {#setup_redraw_elements}

Page elements that need to be redrawn. If the elements are specified, the redrawing will occur even if the `redraw` parameter is set to `false`. By default, the array of elements contains `body`.

### redrawTimeout {#setup_redraw_timeout}

The pause in milliseconds that the browser must endure before redrawing the page elements.

### ignoreElements {#setup_ignore_elements}

Page elements that will be replaced with black rectangles. The specified list of elements will be added to the `ignoreElements` list of Testplane's `assertView` command, every time a screenshot is taken.

### invisibleElements {#setup_invisible_elements}

Page elements that will be made completely transparent. To do this, the style `opacity: 0 !important` is applied to them.

### hideElements {#setup_hide_elements}

Page elements to be hidden. To do this, the `display: none !important` style is applied to them.

### customCSS {#setup_custom_css}

You can set your own styles that will be applied before taking a screenshot.

## Useful links {#useful_links}

-   [hermione-assert-view-extended plugin sources][hermione-assert-view-extended]

[hermione-assert-view-extended]: https://github.com/ruslanxdev/hermione-assert-view-extended
[anti-aliasing]: https://en.wikipedia.org/wiki/Spatial_anti-aliasing
